{% extends 'base.html' %}

{% block title %}{{ event.title }} - GOD CARES 365{% endblock %}

{% block extra_css %}
<style type="text/tailwindcss">
  .page-event .icon-slab{
    border:2px solid color-mix(in oklab, var(--accent-600) 65%, transparent);
    background: color-mix(in oklab, var(--accent-600) 85%, white 15%);
    @apply w-14 h-14 flex items-center justify-center text-white rounded-none;
  }
  .accent-text{ color: var(--accent-600); }
  .accent-bg{ background: var(--accent-600); }
  .accent-bg:hover{ background: color-mix(in oklab, var(--accent-600) 85%, black 15%); }
  .badge-soft{
    background: color-mix(in oklab, var(--accent-600) 14%, white 86%);
    color: var(--accent-700);
  }
  .dark .badge-soft{
    background: color-mix(in oklab, var(--accent-600) 18%, black 82%);
    color: white;
  }
  .btn-accent{
    background: var(--accent-600);
    border-color: color-mix(in oklab, var(--accent-600) 90%, black 10%);
    @apply inline-flex items-center justify-center px-6 py-3 font-semibold text-white border-2 rounded-none transition-colors;
  }
  .btn-accent:hover{ background: color-mix(in oklab, var(--accent-600) 85%, black 15%); }

  /* Card/image safety: zisivuke mipaka */
  .page-event .article-card{ @apply overflow-hidden; }
  .page-event .article-cover{ @apply w-full h-64 md:h-80 object-cover; }

  /* Breadcrumb: mistari + hover accent, hakuna white bg */
  .page-event .crumb a{ @apply hover:underline; }
  .page-event .crumb a:hover{ color: var(--accent-600); }

  /* Sidebar share buttons: outline -> fill on hover */
  .page-event .share-btn{
    @apply flex-1 text-center border-2 rounded-none p-3 transition-colors;
    border-color: color-mix(in oklab, var(--accent-600) 55%, transparent);
    color: var(--accent-700);
  }
  .page-event .share-btn:hover{
    background: var(--accent-600); color: white; border-color: var(--accent-600);
  }

  /* Featured tag (tumia accent badala ya yellow nyingi) */
  .page-event .featured-tag{
    @apply text-xs px-2 py-1 rounded-none text-white;
    background: color-mix(in oklab, var(--accent-600) 80%, black 20%);
  }

  /* Meta icons all accent */
  .page-event .meta i{ color: var(--accent-600); }
</style>
{% endblock %}

{% block content %}
<div class="page-event py-12">
  <div class="page-container px-6">

    <!-- Breadcrumb -->
    <nav class="mb-8">
      <ol class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400 crumb">
        <li><a href="{% url 'home' %}">Nyumbani</a></li>
        <li class="opacity-60">/</li>
        <li><a href="{% url 'events' %}">Matukio</a></li>
        <li class="opacity-60">/</li>
        <li class="text-gray-900 dark:text-white">{{ event.title|truncatewords:5 }}</li>
      </ol>
    </nav>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <!-- Main -->
      <div class="lg:col-span-2">
        <article class="card article-card p-6 md:p-8">
          {% if event.image %}
          <div class="mb-6 -mx-6 md:-mx-8">
            <img src="{{ event.image.url }}" alt="{{ event.title }}" class="article-cover">
          </div>
          {% endif %}

          <!-- Header -->
          <header class="mb-6">
            {% if event.is_featured %}
            <div class="mb-4">
              <span class="featured-tag"><i class="fas fa-star mr-1"></i> Tukio Maalum</span>
            </div>
            {% endif %}

            <h1 class="text-3xl font-bold mb-4 text-gray-800 dark:text-white">
              {{ event.title }}
            </h1>

            <!-- Meta -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6 meta">
              <div class="space-y-3">
                <div class="flex items-center text-gray-600 dark:text-gray-400">
                  <i class="fas fa-calendar mr-3"></i>
                  <div>
                    <div class="font-medium">{{ event.date|date:"l, d M Y" }}</div>
                    <div class="text-sm">
                      {{ event.date|date:"H:i" }}{% if event.end_date %} - {{ event.end_date|date:"H:i" }}{% endif %}
                    </div>
                  </div>
                </div>

                <div class="flex items-center text-gray-600 dark:text-gray-400">
                  <i class="fas fa-map-marker-alt mr-3"></i>
                  <div class="font-medium">{{ event.location }}</div>
                </div>
              </div>

              <div class="space-y-3">
                {% if event.max_attendees %}
                <div class="flex items-center text-gray-600 dark:text-gray-400">
                  <i class="fas fa-users mr-3"></i>
                  <div>
                    <div class="font-medium">Idadi ya Watu</div>
                    <div class="text-sm">Hadi {{ event.max_attendees }} watu</div>
                  </div>
                </div>
                {% endif %}

                <div class="flex items-center text-gray-600 dark:text-gray-400">
                  <i class="fas fa-clock mr-3"></i>
                  <div>
                    <div class="font-medium">Hali</div>
                    <div class="text-sm">
                      {% now "Y-m-d H:i" as current_time %}
                      {% if event.date|date:"Y-m-d H:i" > current_time %}
                        <span class="accent-text">Tukio lijayo</span>
                      {% else %}
                        <span class="text-gray-500">Tukio limepita</span>
                      {% endif %}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </header>

          <!-- Maelezo -->
          <div class="prose prose-lg max-w-none dark:prose-invert mb-8">
            {{ event.description|linebreaks }}
          </div>

          <!-- Usajili / Taarifa -->
          {% if event.registration_url %}
          <div class="badge-soft border-2 p-6 border-[color:color-mix(in_oklab,var(--accent-600)_40%,transparent)]">
            <h3 class="text-lg font-semibold mb-3"><i class="fas fa-user-plus mr-2"></i>Usajili</h3>
            <p class="mb-4">Jiunge nasi katika tukio hili la kipekee. Bofya kitufe hapo chini kujisajili.</p>
            <a href="{{ event.registration_url }}" target="_blank" class="btn-accent">
              <i class="fas fa-external-link-alt mr-2"></i> Jisajili Sasa
            </a>
          </div>
          {% else %}
          <div class="card p-6">
            <h3 class="text-lg font-semibold mb-3 text-gray-800 dark:text-white">
              <i class="fas fa-info-circle mr-2 accent-text"></i>Maelezo ya Ushiriki
            </h3>
            <p class="text-gray-600 dark:text-gray-300 mb-4">
              Kwa maelezo zaidi kuhusu jinsi ya kushiriki katika tukio hili, wasiliana nasi.
            </p>
            <div class="flex flex-col sm:flex-row gap-3">
              <a href="tel:+255767525234" class="btn-accent"><i class="fas fa-phone mr-2"></i> Piga Simu</a>
              <a href="mailto:fmklink@gmail.com" class="btn-accent"><i class="fas fa-envelope mr-2"></i> Tuma Barua Pepe</a>
            </div>
          </div>
          {% endif %}
        </article>
      </div>

      <!-- Sidebar -->
      <div class="space-y-6">
        <!-- Quick Info -->
        <div class="card p-6">
          <h3 class="text-lg font-semibold mb-4 text-gray-800 dark:text-white">Maelezo ya Haraka</h3>
          <div class="space-y-4">
            <div class="flex items-center justify-between">
              <span class="text-sm text-gray-600 dark:text-gray-400">Tarehe:</span>
              <span class="font-medium text-gray-800 dark:text-white">{{ event.date|date:"d/m/Y" }}</span>
            </div>
            <div class="flex items-center justify-between">
              <span class="text-sm text-gray-600 dark:text-gray-400">Muda:</span>
              <span class="font-medium text-gray-800 dark:text-white">{{ event.date|date:"H:i" }}</span>
            </div>
            <div class="flex items-center justify-between">
              <span class="text-sm text-gray-600 dark:text-gray-400">Mahali:</span>
              <span class="font-medium text-gray-800 dark:text-white text-right">{{ event.location }}</span>
            </div>
            {% if event.max_attendees %}
            <div class="flex items-center justify-between">
              <span class="text-sm text-gray-600 dark:text-gray-400">Idadi:</span>
              <span class="font-medium text-gray-800 dark:text-white">{{ event.max_attendees }} watu</span>
            </div>
            {% endif %}
          </div>
        </div>

        <!-- Share Event -->
        <div class="card p-6">
          <h3 class="text-lg font-semibold mb-4 text-gray-800 dark:text-white">Shiriki Tukio</h3>
          <div class="flex gap-3">
            <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri }}" target="_blank" class="share-btn">
              <i class="fab fa-facebook"></i>
            </a>
            <a href="https://twitter.com/intent/tweet?url={{ request.build_absolute_uri }}&text={{ event.title }}" target="_blank" class="share-btn">
              <i class="fab fa-twitter"></i>
            </a>
            <a href="https://wa.me/?text={{ event.title }} {{ request.build_absolute_uri }}" target="_blank" class="share-btn">
              <i class="fab fa-whatsapp"></i>
            </a>
          </div>
        </div>

        <!-- Other links -->
        <div class="card p-6">
          <h3 class="text-lg font-semibold mb-4 text-gray-800 dark:text-white">Matukio Mengine</h3>
          <div class="space-y-3">
            <a href="{% url 'events' %}" class="block text-sm accent-text hover:underline">
              <i class="fas fa-calendar mr-2"></i>Angalia matukio yote
            </a>
            <a href="{% url 'prayer_requests' %}" class="block text-sm accent-text hover:underline">
              <i class="fas fa-heart mr-2"></i>Tuma ombi la maombi
            </a>
            <a href="{% url 'donations' %}" class="block text-sm accent-text hover:underline">
              <i class="fas fa-donate mr-2"></i>Changia kazi ya Mungu
            </a>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>
{% endblock %}
