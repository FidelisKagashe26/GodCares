{% extends "base.html" %}
{% block title %}Badili Nenosiri | GOD CARES 365{% endblock %}
{% block content %}
<div class="card">
  <form method="post" class="p-4 md:p-6 grid gap-4" data-prevent-double-submit>
    {% csrf_token %}
    <h1 class="text-xl md:text-2xl font-extrabold">Badili Nenosiri</h1>

    <div>
      <label class="block text-sm font-semibold mb-1">Nenosiri la sasa</label>
      {{ form.old_password }}
      {% if form.old_password.errors %}
        <p class="text-sm text-red-600 mt-1">{{ form.old_password.errors.0 }}</p>
      {% endif %}
    </div>

    <div class="grid md:grid-cols-2 gap-4">
      <div>
        <label class="block text-sm font-semibold mb-1">Nenosiri jipya</label>
        {{ form.new_password1 }}
        <div id="pw-strength" class="text-xs mt-1 text-gray-500"></div>
        {% if form.new_password1.help_text %}
          <div class="text-xs text-gray-500 mt-1">{{ form.new_password1.help_text|safe }}</div>
        {% endif %}
        {% if form.new_password1.errors %}
          <p class="text-sm text-red-600 mt-1">{{ form.new_password1.errors.0 }}</p>
        {% endif %}
      </div>
      <div>
        <label class="block text-sm font-semibold mb-1">Rudia nenosiri jipya</label>
        {{ form.new_password2 }}
        {% if form.new_password2.errors %}
          <p class="text-sm text-red-600 mt-1">{{ form.new_password2.errors.0 }}</p>
        {% endif %}
      </div>
    </div>

    <div class="grid grid-flow-col auto-cols-max gap-2">
      <button type="submit" class="btn-primary" data-submit-btn>Hifadhi</button>
      <a href="{% url 'account_profile' %}" class="btn-secondary">Ghairi</a>
    </div>
  </form>
</div>

<script>
  // kipimo cha nguvu ya nenosiri (field: new_password1)
  (function(){
    const p1 = document.getElementById('id_new_password1');
    const meter = document.getElementById('pw-strength');
    if(!p1 || !meter) return;
    p1.addEventListener('input', ()=>{
      const v = p1.value || '';
      let s = 0;
      if (v.length >= 8) s++;
      if (/[A-Z]/.test(v) && /[a-z]/.test(v)) s++;
      if (/\d/.test(v)) s++;
      if (/[^A-Za-z0-9]/.test(v)) s++;
      const labels = ['dhaifu','kadri','nzuri','imara'];
      meter.textContent = 'Nguvu ya nenosiri: ' + labels[Math.max(0, s-1)];
    });
  })();
</script>
{% endblock %}
