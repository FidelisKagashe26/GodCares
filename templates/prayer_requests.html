{% extends 'base.html' %}

{% block title %}Maombi ya Pamoja - GOD CARES 365{% endblock %}

{% block extra_css %}
<style type="text/tailwindcss">
  /* -------- PAGE SCOPE -------- */
  .page-prayer .icon-circle{
    background: linear-gradient(135deg, #f5d107ff, #e0dd09ff);
    border:2px solid color-mix(in oklab, #f5e611ff 55%, transparent);
    @apply w-16 h-16 rounded-full flex items-center justify-center text-white;
  }

  /* Inputs & selects from Django widgets (bila kubadilisha Python) */
  .page-prayer input[type="text"],
  .page-prayer input[type="email"],
  .page-prayer input[type="tel"],
  .page-prayer textarea,
  .page-prayer select{
    @apply w-full px-4 py-3 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 border-2 rounded-none;
    border-color: color-mix(in oklab, var(--accent-600) 28%, transparent);
    outline: none;
  }
  .page-prayer textarea{ @apply min-h-[140px]; }

  .page-prayer input[type="text"]:focus,
  .page-prayer input[type="email"]:focus,
  .page-prayer input[type="tel"]:focus,
  .page-prayer textarea:focus,
  .page-prayer select:focus{
    box-shadow: 0 0 0 3px var(--accent-200);
    border-color: color-mix(in oklab, var(--accent-600) 60%, transparent);
  }

  /* Checkboxes */
  .page-prayer input[type="checkbox"]{
    accent-color: var(--accent-600);
    inline-size: 1.1rem; block-size: 1.1rem;
  }

  /* Buttons */
  .page-prayer .btn-accent{
    background: var(--accent-600);
    border-color: color-mix(in oklab, var(--accent-700) 90%, black 10%);
    @apply w-full rounded-none font-semibold px-6 py-4 text-white border-2 transition-colors;
  }
  .page-prayer .btn-accent:hover{ background: color-mix(in oklab, var(--accent-600) 85%, black 15%); }

  /* Alerts */
  .page-prayer .alert-success{
    @apply p-4 rounded-none border-2;
    background: color-mix(in oklab, var(--accent-600) 8%, white 92%);
    border-color: color-mix(in oklab, var(--accent-600) 35%, transparent);
    color: color-mix(in oklab, var(--accent-700) 92%, black 8%);
  }
  .dark .page-prayer .alert-success{
    background: color-mix(in oklab, var(--accent-600) 18%, black 82%);
    border-color: color-mix(in oklab, var(--accent-600) 45%, black 0%);
    color: white;
  }

  /* Verse panel */
  .page-prayer .verse{
    @apply p-6 rounded-none border-2;
    border-color: color-mix(in oklab, #ef4444 40%, transparent);
    background: color-mix(in oklab, #ef4444 10%, white 90%);
  }
  .dark .page-prayer .verse{
    background: color-mix(in oklab, #ef4444 18%, black 82%);
    border-color: color-mix(in oklab, #ef4444 45%, black 0%);
  }
</style>
{% endblock %}

{% block content %}
<div class="page-prayer py-12">
  <div class="container mx-auto px-6">
    <!-- Header -->
    <header class="text-center mb-12">
      <div class="icon-circle mx-auto mb-4">
        <i class="fas fa-users text-2xl"></i>
      </div>
      <h1 class="text-4xl font-bold mb-4 text-gray-800 dark:text-white">Maombi ya Pamoja</h1>
      <p class="text-lg max-w-2xl mx-auto text-gray-600 dark:text-gray-300">
        Tuma ombi lako na tuombe pamoja kama jamii ya imani. Hakuna ombi dogo au kubwa — Mungu anasikia yote.
      </p>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <!-- Form -->
      <div class="lg:col-span-2">
        <div class="card p-8">
          <h2 class="text-2xl font-bold mb-6 text-gray-800 dark:text-white">Tuma Ombi Lako</h2>

          {% if messages %}
            {% for message in messages %}
              <div class="mb-6 alert-success">
                <div class="flex items-center">
                  <i class="fas fa-check-circle mr-2"></i>
                  {{ message }}
                </div>
              </div>
            {% endfor %}
          {% endif %}

          <form method="post" class="space-y-6">
            {% csrf_token %}

            <!-- Personal Information -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">
                  {{ form.name.label }} <span class="text-red-500" id="name-required">*</span>
                </label>
                {{ form.name }}
                {% if form.name.errors %}
                  <p class="text-red-500 text-xs mt-1">{{ form.name.errors.0 }}</p>
                {% endif %}
              </div>
              <div>
                <label class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">
                  {{ form.email.label }}
                </label>
                {{ form.email }}
                {% if form.email.errors %}
                  <p class="text-red-500 text-xs mt-1">{{ form.email.errors.0 }}</p>
                {% endif %}
              </div>
            </div>

            <div>
              <label class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">
                {{ form.phone.label }}
              </label>
              {{ form.phone }}
              {% if form.phone.errors %}
                <p class="text-red-500 text-xs mt-1">{{ form.phone.errors.0 }}</p>
              {% endif %}
            </div>

            <!-- Category -->
            <div>
              <label class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">
                {{ form.category.label }} <span class="text-red-500">*</span>
              </label>
              {{ form.category }}
              {% if form.category.errors %}
                <p class="text-red-500 text-xs mt-1">{{ form.category.errors.0 }}</p>
              {% endif %}
            </div>

            <!-- Prayer Request -->
            <div>
              <label class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">
                {{ form.request.label }} <span class="text-red-500">*</span>
              </label>
              {{ form.request }}
              {% if form.request.errors %}
                <p class="text-red-500 text-xs mt-1">{{ form.request.errors.0 }}</p>
              {% endif %}
            </div>

            <!-- Options -->
            <div class="space-y-4">
              <label class="flex items-center">
                {{ form.is_anonymous }}
                <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">{{ form.is_anonymous.label }}</span>
              </label>
              <label class="flex items-center">
                {{ form.is_urgent }}
                <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">{{ form.is_urgent.label }}</span>
              </label>
            </div>

            {% if form.non_field_errors %}
              <div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-300 px-4 py-3 rounded-none">
                {{ form.non_field_errors.0 }}
              </div>
            {% endif %}

            <!-- Submit -->
            <button type="submit" class="btn-accent">
              <i class="fas fa-paper-plane mr-2"></i>
              Tuma Ombi
            </button>
          </form>
        </div>
      </div>

      <!-- Sidebar -->
      <div class="space-y-6">
        <!-- Guidelines -->
        <div class="card p-6">
          <h3 class="text-lg font-semibold mb-4 text-gray-800 dark:text-white">Miongozo ya Maombi</h3>
          <ul class="space-y-2 text-sm text-gray-600 dark:text-gray-300">
            <li class="flex items-start"><i class="fas fa-heart text-yellow-500 mr-2 mt-0.5"></i> Omba kwa moyo wa uwazi na imani</li>
            <li class="flex items-start"><i class="fas fa-shield-alt text-yellow-500 mr-2 mt-0.5"></i> Maombi yako ni siri na salama</li>
            <li class="flex items-start"><i class="fas fa-users text-yellow-500 mr-2 mt-0.5"></i> Timu yetu itaomba kwa ajili yako</li>
            <li class="flex items-start"><i class="fas fa-clock text-yellow-500 mr-2 mt-0.5"></i> Maombi ya haraka yanapewa kipaumbele</li>
          </ul>
        </div>

        <!-- Verse -->
        <div class="card p-6 bg-blue-50 dark:bg-blue-900/20">
          <blockquote class="text-blue-700 dark:text-blue-300 font-medium mb-2">
            “Msiwe na wasiwasi juu ya chochote, bali katika kila jambo, kwa maombi na dua,
            pamoja na shukrani, mjulishe Mungu mahitaji yenu.”
          </blockquote>
          <cite class="text-blue-600 dark:text-blue-400 text-sm">— Wafilipi 4:6</cite>
        </div>

        <!-- Urgent Contact -->
        <div class="card p-6">
          <h3 class="text-lg font-semibold mb-4 text-gray-800 dark:text-white">Maombi ya Haraka</h3>
          <p class="text-sm mb-4 text-gray-600 dark:text-gray-300">Kwa maombi ya haraka, wasiliana nasi moja kwa moja:</p>
          <div class="space-y-2 text-sm">
            <div class="flex items-center text-gray-600 dark:text-gray-300"><i class="fas fa-phone mr-2"></i> <span>+255 767 525 234</span></div>
            <div class="flex items-center text-gray-600 dark:text-gray-300"><i class="fas fa-envelope mr-2"></i> <span>fmklink@gmail.com</span></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Field toggling for Anonymous -->
<script>
document.addEventListener('DOMContentLoaded', function(){
  const anon = document.getElementById('{{ form.is_anonymous.id_for_label }}');
  const nameEl = document.getElementById('{{ form.name.id_for_label }}');
  const emailEl = document.getElementById('{{ form.email.id_for_label }}');
  const phoneEl = document.getElementById('{{ form.phone.id_for_label }}');
  const reqStar = document.getElementById('name-required');

  function toggleFields(){
    if(!anon) return;
    const disabled = anon.checked;
    [nameEl, emailEl, phoneEl].forEach(el => { if(el){ el.disabled = disabled; if(disabled) el.value=''; }});
    if(reqStar) reqStar.style.display = disabled ? 'none' : 'inline';
  }
  if(anon){
    anon.addEventListener('change', toggleFields);
    toggleFields();
  }
});
</script>
{% endblock %}
