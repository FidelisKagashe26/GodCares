{% extends 'base.html' %}

{% block title %}Habari & Vipengele - GOD CARES 365{% endblock %}

{% block extra_css %}
<style type="text/tailwindcss">
  /* ---------- NEWS PAGE: muonekano sawa na About ---------- */
  .page-news .icon-slab{
    border:2px solid color-mix(in oklab, var(--accent-600) 65%, transparent);
    background: color-mix(in oklab, var(--accent-600) 85%, white 15%);
    @apply w-16 h-16 grid place-items-center text-white rounded-none;
  }

  .page-news .section-title{ @apply relative inline-block pb-2; }
  .page-news .section-title::after{
    content:""; position:absolute; left:0; bottom:0; height:3px; width:64px; background:var(--accent-600);
  }

  /* Media frame (16:9) */
  .page-news .media{ position:relative; width:100%; padding-top:56.25%; }
  .page-news .media > img{ position:absolute; inset:0; width:100%; height:100%; object-fit:cover; }

  /* Chips (accent-aware) */
  .page-news .chip{
    background: color-mix(in oklab, var(--accent-600) 18%, white 82%);
    color: color-mix(in oklab, var(--accent-600) 90%, black 10%);
    @apply text-xs px-2 py-1 rounded-none border;
    border-color: color-mix(in oklab, var(--accent-600) 45%, transparent);
  }
  .dark .page-news .chip{
    background: color-mix(in oklab, var(--accent-600) 22%, black 78%);
    color:#fff; border-color: color-mix(in oklab, var(--accent-600) 55%, black 45%);
  }

  /* Clamp */
  .page-news .clamp-2{ display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; }
  .page-news .clamp-3{ display:-webkit-box; -webkit-line-clamp:3; -webkit-box-orient:vertical; overflow:hidden; }

  /* Inputs (square + accent focus â€“ sawa na About) */
  .page-news .form-input{
    @apply w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-700 rounded-none bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100;
  }
  .page-news .form-input:focus{
    outline:none; box-shadow:0 0 0 3px var(--accent-200); border-color:var(--accent-600);
  }
  .page-news .btn-accent{
    background:var(--accent-600);
    border-color:color-mix(in oklab, var(--accent-600) 90%, black 10%);
    @apply text-white font-semibold px-6 py-3 rounded-none border-2 transition-colors;
  }
  .page-news .btn-accent:hover{ background:var(--accent-700); }
</style>
{% endblock %}

{% block content %}
<div class="page-news py-12">
  <div class="page-container px-6">

    <!-- Header (sawa na About) -->
    <header class="text-center mb-12">
      <div class="icon-slab mx-auto mb-4">
        <i class="fas fa-newspaper text-2xl"></i>
      </div>
      <h1 class="text-4xl font-bold mb-3 text-gray-800 dark:text-white">Habari & Vipengele</h1>
      <p class="text-lg max-w-2xl mx-auto text-gray-600 dark:text-gray-300">
        Soma makala za kiroho, habari za jamii, na vipengele vya kujenga imani
      </p>
    </header>

    <!-- Search & Filter (GRID tu, hakuna flex) -->
    <div class="mb-8">
      <form method="get" class="grid grid-cols-1 md:grid-cols-[1fr,220px,auto] gap-4 items-stretch">
        <!-- search -->
        <div class="relative">
          <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-500"></i>
          <input
            type="text" name="search" value="{{ search_query }}" placeholder="Tafuta habari..."
            class="form-input pl-10"
          />
        </div>
        <!-- category -->
        <div class="relative">
          <i class="fas fa-filter absolute left-3 top-1/2 -translate-y-1/2 text-gray-500"></i>
          <select name="category" class="form-input pl-10 pr-8">
            <option value="all" {% if category_filter == 'all' %}selected{% endif %}>Yote</option>
            {% for category in categories %}
              <option value="{{ category.slug }}" {% if category_filter == category.slug %}selected{% endif %}>
                {{ category.name }}
              </option>
            {% endfor %}
          </select>
        </div>
        <!-- button -->
        <button type="submit" class="btn-accent grid place-items-center">Tafuta</button>
      </form>
    </div>

    <!-- Posts Grid -->
    {% if page_obj %}
      <section aria-label="Orodha ya Habari">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
          {% for post in page_obj %}
          <a href="{% url 'news_detail' post.slug %}" class="card overflow-hidden group">
            <!-- Picha / badge -->
            <div class="media">
              {% if post.featured_image %}
                <img src="{{ post.featured_image.url }}" alt="{{ post.title }}" loading="lazy">
              {% else %}
                <div class="absolute inset-0 grid place-items-center bg-gray-200 dark:bg-gray-700">
                  <i class="fas fa-newspaper text-gray-400 text-4xl"></i>
                </div>
              {% endif %}
              <div class="absolute top-3 left-3 chip">{{ post.category.name }}</div>
              {% if post.featured %}
                <div class="absolute top-3 right-3 chip" title="Imependekezwa"><i class="fas fa-star"></i></div>
              {% endif %}
            </div>

            <!-- Maandishi -->
            <div class="p-6">
              <h3 class="text-lg font-bold mb-3 text-gray-800 dark:text-white clamp-2">
                {{ post.title }}
              </h3>
              <p class="text-sm mb-4 text-gray-600 dark:text-gray-300 clamp-3">
                {{ post.excerpt|default:post.content|striptags|truncatewords:30 }}
              </p>

              <!-- Meta: GRID (kushoto mwandishi+tarehe, kulia views) -->
              <div class="grid grid-cols-[1fr,auto] items-center text-xs">
                <div class="grid grid-flow-col auto-cols-max gap-4">
                  <span class="grid grid-flow-col auto-cols-max items-center gap-1">
                    <i class="fas fa-user"></i>
                    <span>{{ post.author.get_full_name|default:post.author.username }}</span>
                  </span>
                  <span class="grid grid-flow-col auto-cols-max items-center gap-1">
                    <i class="fas fa-calendar"></i>
                    <span>{{ post.published_at|date:"d M Y" }}</span>
                  </span>
                </div>
                <div class="grid grid-flow-col auto-cols-max items-center gap-1 justify-self-end">
                  <i class="fas fa-eye"></i>
                  <span>{{ post.views }}</span>
                </div>
              </div>

              <!-- CTA -->
              <div class="mt-4 grid grid-flow-col auto-cols-max items-center gap-2 text-blue-600 group-hover:text-blue-700">
                <span class="text-sm font-medium">Soma zaidi</span>
                <i class="fas fa-arrow-right"></i>
              </div>
            </div>
          </a>
          {% endfor %}
        </div>
      </section>

      <!-- Pagination (GRID, katikati) -->
      {% if page_obj.has_other_pages %}
      <nav aria-label="Ukurasa" class="mt-12 grid place-items-center">
        <div class="grid grid-flow-col auto-cols-max gap-2">
          {% if page_obj.has_previous %}
          <a href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if category_filter != 'all' %}&category={{ category_filter }}{% endif %}"
             class="px-4 py-2 rounded-none font-medium bg-gray-200 text-gray-700 hover:bg-gray-300 border-2 border-gray-300">
            <i class="fas fa-chevron-left"></i>
          </a>
          {% endif %}

          {% for num in page_obj.paginator.page_range %}
            {% if page_obj.number == num %}
              <span class="px-4 py-2 rounded-none font-medium bg-blue-600 text-white border-2 border-blue-700">{{ num }}</span>
            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
              <a href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}{% if category_filter != 'all' %}&category={{ category_filter }}{% endif %}"
                 class="px-4 py-2 rounded-none font-medium bg-gray-200 text-gray-700 hover:bg-gray-300 border-2 border-gray-300">
                {{ num }}
              </a>
            {% endif %}
          {% endfor %}

          {% if page_obj.has_next %}
          <a href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if category_filter != 'all' %}&category={{ category_filter }}{% endif %}"
             class="px-4 py-2 rounded-none font-medium bg-gray-200 text-gray-700 hover:bg-gray-300 border-2 border-gray-300">
            <i class="fas fa-chevron-right"></i>
          </a>
          {% endif %}
        </div>
      </nav>
      {% endif %}
    {% else %}
      <div class="card p-8 grid place-items-center text-center">
        <i class="fas fa-newspaper text-gray-400 text-5xl mb-4"></i>
        <p class="text-lg text-gray-500">Hakuna habari zilizopatikana</p>
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}
