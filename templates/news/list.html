{% extends 'base.html' %}

{% block title %}Habari & Vipengele - GOD CARES 365{% endblock %}

{% block extra_css %}
<style type="text/tailwindcss">
  /* -------- PAGE SCOPE (sawa na About, bila kuvunja base) -------- */
  .page-news .media{ position:relative; width:100%; padding-top:56.25%; } /* 16:9 */
  .page-news .media > img{ position:absolute; inset:0; width:100%; height:100%; object-fit:cover; }

  /* chips za kategoria/featured – zinategemea accent */
  .page-news .chip{
    background: color-mix(in oklab, var(--accent-600) 18%, white 82%);
    color: color-mix(in oklab, var(--accent-600) 90%, black 10%);
    @apply text-xs px-2 py-1 rounded-none border;
    border-color: color-mix(in oklab, var(--accent-600) 45%, transparent);
  }
  .dark .page-news .chip{
    background: color-mix(in oklab, var(--accent-600) 22%, black 78%);
    color:#fff; border-color: color-mix(in oklab, var(--accent-600) 55%, black 45%);
  }

  /* clamp ili title/ excerpt visizidi card */
  .page-news .clamp-2{ display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; }
  .page-news .clamp-3{ display:-webkit-box; -webkit-line-clamp:3; -webkit-box-orient:vertical; overflow:hidden; }

  /* hover ya kichwa – tumia accent, usi-scale picha (sawa na About) */
  .page-news .title-link{ @apply text-gray-800 dark:text-white; }
  .page-news .card:hover .title-link{ color: var(--accent-600); }
</style>
{% endblock %}

{% block content %}
<div class="page-news py-12">
  <div class="container mx-auto px-6">
    <!-- Header (style kama About) -->
    <header class="text-center mb-12">
      <div class="w-16 h-16 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-full flex items-center justify-center mx-auto mb-4">
        <i class="fas fa-newspaper text-white text-2xl"></i>
      </div>
      <h1 class="text-4xl font-bold mb-4 text-gray-800 dark:text-white">Habari & Vipengele</h1>
      <p class="text-lg max-w-2xl mx-auto text-gray-600 dark:text-gray-300">
        Soma makala za kiroho, habari za jamii, na vipengele vya kujenga imani
      </p>
    </header>

    <!-- Search & Filter (acha muonekano uleule) -->
    <div class="flex flex-col md:flex-row gap-4 mb-8">
      <form method="get" class="flex flex-col md:flex-row gap-4 w-full">
        <div class="relative flex-1">
          <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-500"></i>
          <input
            type="text"
            name="search"
            value="{{ search_query }}"
            placeholder="Tafuta habari..."
            class="w-full pl-10 pr-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
        </div>
        <div class="relative">
          <i class="fas fa-filter absolute left-3 top-1/2 -translate-y-1/2 text-gray-500"></i>
          <select
            name="category"
            class="pl-10 pr-8 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"
          >
            <option value="all" {% if category_filter == 'all' %}selected{% endif %}>Yote</option>
            {% for category in categories %}
              <option value="{{ category.slug }}" {% if category_filter == category.slug %}selected{% endif %}>
                {{ category.name }}
              </option>
            {% endfor %}
          </select>
        </div>
        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors">
          Tafuta
        </button>
      </form>
    </div>

    <!-- Posts Grid -->
    {% if page_obj %}
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {% for post in page_obj %}
          <a href="{% url 'news_detail' post.slug %}" class="card overflow-hidden group">
            <!-- Picha ndani ya frame (16:9), isivuke box -->
            <div class="media">
              {% if post.featured_image %}
                <img src="{{ post.featured_image.url }}" alt="{{ post.title }}" loading="lazy">
              {% else %}
                <div class="absolute inset-0 bg-gray-200 dark:bg-gray-700 flex items-center justify-center">
                  <i class="fas fa-newspaper text-gray-400 text-4xl"></i>
                </div>
              {% endif %}

              <div class="absolute top-3 left-3 chip">{{ post.category.name }}</div>
              {% if post.featured %}
                <div class="absolute top-3 right-3 chip"><i class="fas fa-star"></i></div>
              {% endif %}
            </div>

            <!-- Maandishi -->
            <div class="p-6">
              <h3 class="text-lg font-bold mb-3 title-link clamp-2">
                {{ post.title }}
              </h3>
              <p class="text-sm mb-4 text-gray-600 dark:text-gray-300 clamp-3">
                {{ post.excerpt|default:post.content|striptags|truncatewords:30 }}
              </p>

              <div class="flex items-center justify-between text-xs">
                <div class="flex items-center space-x-4">
                  <span class="flex items-center">
                    <i class="fas fa-user mr-1"></i>
                    {{ post.author.get_full_name|default:post.author.username }}
                  </span>
                  <span class="flex items-center">
                    <i class="fas fa-calendar mr-1"></i>
                    {{ post.published_at|date:"d M Y" }}
                  </span>
                </div>
                <div class="flex items-center space-x-2">
                  <span class="flex items-center">
                    <i class="fas fa-eye mr-1"></i>
                    {{ post.views }}
                  </span>
                </div>
              </div>

              <div class="mt-4 flex items-center text-blue-600 group-hover:text-blue-700">
                <span class="text-sm font-medium">Soma zaidi</span>
                <i class="fas fa-arrow-right ml-1"></i>
              </div>
            </div>
          </a>
        {% endfor %}
      </div>

      <!-- Pagination (imebaki kama awali) -->
      {% if page_obj.has_other_pages %}
        <div class="flex justify-center mt-12 space-x-2">
          {% if page_obj.has_previous %}
            <a href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if category_filter != 'all' %}&category={{ category_filter }}{% endif %}"
               class="px-4 py-2 rounded-lg font-medium transition-colors bg-gray-200 text-gray-700 hover:bg-gray-300">
              <i class="fas fa-chevron-left"></i>
            </a>
          {% endif %}

          {% for num in page_obj.paginator.page_range %}
            {% if page_obj.number == num %}
              <span class="px-4 py-2 rounded-lg font-medium bg-blue-600 text-white">{{ num }}</span>
            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
              <a href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}{% if category_filter != 'all' %}&category={{ category_filter }}{% endif %}"
                 class="px-4 py-2 rounded-lg font-medium transition-colors bg-gray-200 text-gray-700 hover:bg-gray-300">
                {{ num }}
              </a>
            {% endif %}
          {% endfor %}

          {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if category_filter != 'all' %}&category={{ category_filter }}{% endif %}"
               class="px-4 py-2 rounded-lg font-medium transition-colors bg-gray-200 text-gray-700 hover:bg-gray-300">
              <i class="fas fa-chevron-right"></i>
            </a>
          {% endif %}
        </div>
      {% endif %}
    {% else %}
      <div class="text-center card p-8">
        <i class="fas fa-newspaper text-gray-400 text-5xl mb-4"></i>
        <p class="text-lg text-gray-500">Hakuna habari zilizopatikana</p>
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}
